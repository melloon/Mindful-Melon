<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Firebase Push Notification</title>
</head>
<body>
  <h1>Firebase Push Notification</h1>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
    import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-messaging.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCyget8j28YvgRmRpO9xdHXiyq01T2wWTY",
      authDomain: "hackothon-e5cd6.firebaseapp.com",
      projectId: "hackothon-e5cd6",
      storageBucket: "hackothon-e5cd6.appspot.com",
      messagingSenderId: "1096797340567",
      appId: "1:1096797340567:web:aad6a5dcc98cbac2d2fad2",
      measurementId: "G-F28GH31DWJ"
    };

    const app = initializeApp(firebaseConfig);
    const messaging = getMessaging(app);

    async function requestPermissionAndToken() {
      console.log("Requesting notification permission...");
      const permission = await Notification.requestPermission();

      if (permission === "granted") {
        console.log("Notification permission granted.");
        try {
          const registration = await navigator.serviceWorker.register("sw.js");

          const currentToken = await getToken(messaging, {
            serviceWorkerRegistration: registration,
            vapidKey: "BK8vC7j9H1Fa9W6TifwOUpAy7tTNcUE7UOpazfZG9TesU-xhkRNpNDjoyVi9Dzir9J0AT4qwWSofYzWifjXr6ro"
          });

          if (currentToken) {
            console.log("âœ… FCM Token:", currentToken);

            // Send token to your server
            await fetch("send.php", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ token: currentToken }),
            });

            console.log("ðŸ“¡ Token sent to server successfully!");
          } else {
            console.warn("âš ï¸ No registration token available.");
          }
        } catch (err) {
          console.error("An error occurred while retrieving token: ", err);
        }
      } else {
        console.warn("Notification permission denied.");
      }
    }

    // Listen for messages while page is in foreground
    onMessage(messaging, (payload) => {
      console.log("ðŸ“© Message received in foreground:", payload);
      alert(`Notification: ${payload.notification.title}\n${payload.notification.body}`);
    });

    requestPermissionAndToken();
  </script>
</body>
</html>
